<body>
  <div id="nav"></div>
  <script>
    fetch("/_nav.html").then(r=>r.text()).then(html => {
      document.getElementById("nav").innerHTML = html;
    });
  </script>
  <!-- el resto de tu página -->
<!-- public/admin.html – Panel Admin (global, players, quests, mantenimiento) -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MMORPG Admin</title>
  <style>
    :root { --bg:#0f0f10; --fg:#f5f5f5; --muted:#b9b9b9; --card:#18191c; --accent:#ff5757; --ok:#2ecc71; }
    * { box-sizing: border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    body { margin: 0; background: var(--bg); color: var(--fg); padding: 16px; }
    h1 { margin: 0 0 12px; }
    .card { background: var(--card); border-radius: 12px; padding: 14px; margin: 14px 0; box-shadow: 0 2px 16px rgba(0,0,0,.35); }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media(min-width:920px){ .row-2 { grid-template-columns: 1fr 1fr; } }
    label { font-size: 12px; color: var(--muted); display:block; margin: 6px 0 4px; }
    input, select { width: 100%; padding: 10px 12px; border: 1px solid #333; border-radius: 8px; background:#101114; color: var(--fg); }
    button { border:0; background:#222; color:var(--fg); padding:10px 14px; border-radius:10px; cursor:pointer; }
    button.ok { background: var(--ok); color:#000; font-weight:700; }
    button.warn { background: var(--accent); }
    .btnline { display:flex; gap:8px; flex-wrap:wrap; }
    pre { background:#000; color:#3cff71; padding:12px; border-radius:10px; overflow:auto; min-height:64px; }
    .tag { display:inline-block; padding:4px 8px; background:#222; border-radius:6px; color:#ccc; font-size:12px; }
  </style>
</head>
<body>
  <h1>MMORPG Admin</h1>

  <div class="card">
    <div class="row">
      <div>
        <label>Admin secret</label>
        <input id="secret" type="password" placeholder="Escribe tu clave admin" />
      </div>
    </div>
    <div class="btnline">
      <button id="saveSecret" class="ok">Guardar clave</button>
      <button id="forgetSecret">Olvidar clave</button>
      <span class="tag">Se envía en el header <b>x-admin-secret</b></span>
    </div>
  </div>

  <div class="row row-2">
    <!-- Progreso global -->
    <section class="card">
      <h2>Progreso global</h2>
      <div class="btnline">
        <button id="btnViewGlobal">Ver progreso</button>
        <button id="btnPlus5">+5</button>
        <button id="btnPlus100">+100</button>
      </div>
      <label>current</label><input id="g_current" type="number" value="0" />
      <label>goal</label><input id="g_goal" type="number" value="10000" />
      <label>stage</label><input id="g_stage" type="number" value="0" />
      <div class="btnline"><button id="btnSaveGlobal" class="ok">Guardar</button></div>
    </section>

    <!-- Jugadores -->
    <section class="card">
      <h2>Jugadores</h2>
      <div class="btnline">
        <button id="btnListPlayers">Listar</button>
        <button id="btnTop">Top 10 (XP)</button>
      </div>
      <label>name (único)</label><input id="p_name" placeholder="Jugador1" />
      <label>level</label><input id="p_level" type="number" value="1" />
      <label>xp (opcional)</label><input id="p_xp" type="number" value="0" />
      <div class="btnline">
        <button id="btnUpsert" class="ok">Crear/Actualizar</button>
        <button id="btnAdd50">+50 XP</button>
        <button id="btnDelete" class="warn">Borrar jugador</button>
      </div>
      <div class="btnline">
        <button id="btnPruneOne">PRUNE por nombre (limpia duplicados)</button>
        <button id="btnPruneAll">PRUNE-ALL (normaliza colección)</button>
      </div>
    </section>
  </div>

  <!-- Quests -->
  <section class="card">
    <h2>Quests</h2>
    <div class="btnline">
      <button id="qList">Listar</button>
    </div>
    <div class="row row-2">
      <div>
        <label>title</label><input id="q_title" placeholder="Recolecta 10 gemas" />
      </div>
      <div>
        <label>status</label>
        <select id="q_status">
          <option value="open">open</option>
          <option value="doing">doing</option>
          <option value="done">done</option>
        </select>
      </div>
    </div>
    <div class="btnline">
      <button id="qCreate" class="ok">Crear</button>
      <input id="q_id" placeholder="id para editar/borrar" style="max-width:220px" />
      <button id="qEdit">Editar</button>
      <button id="qDelete" class="warn">Borrar</button>
    </div>
  </section>

  <!-- Salida -->
  <section class="card">
    <h2>Salida</h2>
    <pre id="out">-</pre>
  </section>

<script>
const BASE = ""; // mismo host
const out = (x) => { document.getElementById("out").textContent =
  (typeof x === "string") ? x : JSON.stringify(x, null, 2); };

const secretEl = document.getElementById("secret");
const loadSecret = () => secretEl.value = localStorage.getItem("ADMIN_SECRET") || "";
const getHdr = () => {
  const s = secretEl.value.trim();
  return s ? { "x-admin-secret": s, "Content-Type": "application/json" }
           : { "Content-Type": "application/json" };
};
document.getElementById("saveSecret").onclick = () => {
  localStorage.setItem("ADMIN_SECRET", secretEl.value.trim()); out({ ok:true, msg:"Clave guardada" });
};
document.getElementById("forgetSecret").onclick = () => {
  localStorage.removeItem("ADMIN_SECRET"); secretEl.value=""; out({ ok:true, msg:"Clave borrada" });
};
loadSecret();

// ---- Global
const gcur = document.getElementById("g_current");
const ggoal = document.getElementById("g_goal");
const gst = document.getElementById("g_stage");
document.getElementById("btnViewGlobal").onclick = async () => {
  const r = await fetch(`${BASE}/global`); const j = await r.json(); out(j);
  gcur.value = j.current ?? 0; ggoal.value = j.goal ?? 0; gst.value = j.stage ?? 0;
};
document.getElementById("btnPlus5").onclick = () => gcur.value = Number(gcur.value||0) + 5;
document.getElementById("btnPlus100").onclick = () => gcur.value = Number(gcur.value||0) + 100;
document.getElementById("btnSaveGlobal").onclick = async () => {
  const r = await fetch(`${BASE}/global`, { method:"PATCH", headers:getHdr(),
    body: JSON.stringify({ current:Number(gcur.value||0), goal:Number(ggoal.value||0), stage:Number(gst.value||0) })});
  out(await r.json());
};

// ---- Players
const pname = document.getElementById("p_name");
const plevel = document.getElementById("p_level");
const pxp = document.getElementById("p_xp");

document.getElementById("btnListPlayers").onclick = async () => {
  const r = await fetch(`${BASE}/players?limit=50`); out(await r.json());
};
document.getElementById("btnTop").onclick = async () => {
  const r = await fetch(`${BASE}/leaderboard?limit=10`); out(await r.json());
};
document.getElementById("btnUpsert").onclick = async () => {
  const name = pname.value.trim(); if(!name) return out("name requerido");
  const r = await fetch(`${BASE}/players/${encodeURIComponent(name)}`, {
    method:"PUT", headers:getHdr(),
    body: JSON.stringify({ level:Number(plevel.value||1), xp:Number(pxp.value||0) })
  });
  out(await r.json());
};
document.getElementById("btnAdd50").onclick = async () => {
  const name = pname.value.trim(); if(!name) return out("name requerido");
  const r = await fetch(`${BASE}/players/addxp`, {
    method:"POST", headers:getHdr(), body: JSON.stringify({ name, xp:50 })
  }); out(await r.json());
};
document.getElementById("btnDelete").onclick = async () => {
  const name = pname.value.trim(); if(!name) return out("name requerido");
  const r = await fetch(`${BASE}/players/${encodeURIComponent(name)}`, {
    method:"DELETE", headers:getHdr()
  }); out(await r.json());
};
document.getElementById("btnPruneOne").onclick = async () => {
  const name = pname.value.trim(); if(!name) return out("name requerido");
  const r = await fetch(`${BASE}/players/prune?name=${encodeURIComponent(name)}`, {
    method:"POST", headers:getHdr()
  }); out(await r.json());
};
document.getElementById("btnPruneAll").onclick = async () => {
  const r = await fetch(`${BASE}/players/prune-all`, { method:"POST", headers:getHdr() });
  out(await r.json());
};

// ---- Quests
const q_title = document.getElementById("q_title");
const q_status = document.getElementById("q_status");
const q_id = document.getElementById("q_id");

document.getElementById("qList").onclick = async () => {
  const r = await fetch(`${BASE}/quests`); out(await r.json());
};
document.getElementById("qCreate").onclick = async () => {
  const r = await fetch(`${BASE}/quests`, { method:"POST", headers:getHdr(),
    body: JSON.stringify({ title:q_title.value.trim(), status:q_status.value }) });
  out(await r.json());
};
document.getElementById("qEdit").onclick = async () => {
  const id = q_id.value.trim(); if(!id) return out("id requerido");
  const r = await fetch(`${BASE}/quests/${encodeURIComponent(id)}`, { method:"PATCH", headers:getHdr(),
    body: JSON.stringify({ title:q_title.value.trim(), status:q_status.value }) });
  out(await r.json());
};
document.getElementById("qDelete").onclick = async () => {
  const id = q_id.value.trim(); if(!id) return out("id requerido");
  const r = await fetch(`${BASE}/quests/${encodeURIComponent(id)}`, { method:"DELETE", headers:getHdr() });
  out(await r.json());
};
</script>
</body>
</html>
